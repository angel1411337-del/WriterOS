============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\rahme\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\rahme\IdeaProjects\YouTube Transcript Agent
configfile: pyproject.toml
plugins: anyio-4.11.0, Faker-38.2.0, langsmith-0.4.45, asyncio-1.3.0, cov-7.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/agents/test_profiler_agent.py::TestProfilerAgent::test_entity_extraction PASSED [  9%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_find_similar_entities PASSED [ 18%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_generate_graph_data PASSED [ 27%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_simple FAILED [ 36%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_multi_generation FAILED [ 45%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_with_siblings FAILED [ 54%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_with_child_relationship FAILED [ 63%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_empty FAILED [ 72%]
tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_nonexistent_entity FAILED [ 81%]
tests/agents/test_profiler_agent.py::TestProfilerAgentHelpers::test_format_nodes PASSED [ 90%]
tests/agents/test_profiler_agent.py::TestProfilerAgentHelpers::test_format_links PASSED [100%]

================================== FAILURES ===================================
_______________ TestProfilerAgent.test_build_family_tree_simple _______________

self = <test_profiler_agent.TestProfilerAgent object at 0x0000019FC9401A70>
profiler = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FC995FCE0>
db_session = <sqlmodel.orm.session.Session object at 0x0000019FC9B78770>
sample_vault_id = UUID('e8ef07bd-bd25-4ff1-8e4b-80668b4e5609')

    @pytest.mark.asyncio
    async def test_build_family_tree_simple(self, profiler, db_session, sample_vault_id):
        """Test family tree construction with simple parent-child relationship."""
        # Create a simple family
        parent = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Parent",
            type=EntityType.CHARACTER,
            description="Parent character",
            properties={"role": "parent"},
            embedding=[0.1] * 1536
        )
        child = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Child",
            type=EntityType.CHARACTER,
            description="Child character",
            properties={"role": "child"},
            embedding=[0.2] * 1536
        )
    
        db_session.add(parent)
        db_session.add(child)
    
        rel = Relationship(
            id=uuid4(),
            vault_id=sample_vault_id,
            from_entity_id=parent.id,
            to_entity_id=child.id,
            rel_type=RelationType.PARENT,
            description="Parent-child relationship",
            properties={"strength": 1.0}
        )
        db_session.add(rel)
        db_session.commit()
    
        # Test from parent's perspective
>       tree = await profiler.build_family_tree(parent.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\agents\test_profiler_agent.py:134: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FC995FCE0>
character_id = UUID('3e4ee750-09f8-4771-a349-2afc7a865fbf')

    async def build_family_tree(self, character_id: UUID) -> Dict[str, Any]:
        """
        Builds a family tree visualization using NetworkX graph traversal.
        Traverses family relationships to find all family members and their generation levels.
    
        Uses NetworkX for graph analysis, enabling future features like:
        - Political influence pathfinding
        - Alliance mapping
        - Chemistry/relationship strength calculation
    
        Returns a hierarchical structure with:
        - All family members with their properties
        - Generation levels (negative = ancestors, positive = descendants, 0 = same generation)
        - Total member count and generation range
    
        Args:
            character_id: UUID of the character to build the tree from
    
        Returns:
            Dict containing:
                - total_members: int
                - generation_range: {"min": int, "max": int}
                - generations: {generation_level: [{"id": str, "name": str, "type": str, "properties": dict}]}
        """
        import networkx as nx
        from collections import deque
    
        self.log.info("building_family_tree", character_id=str(character_id))
    
        # Step 1: Fetch the root entity to get vault_id
>       with Session(db_utils.engine) as session:
                     ^^^^^^^^
E       NameError: name 'db_utils' is not defined

src\writeros\agents\profiler.py:112: NameError
---------------------------- Captured stdout setup ----------------------------
2025-11-25 16:31:04 [info     ] agent_initialized              agent=ProfilerAgent model=gpt-4
---------------------------- Captured stdout call -----------------------------
2025-11-25 16:31:05 [info     ] building_family_tree           agent=ProfilerAgent character_id=3e4ee750-09f8-4771-a349-2afc7a865fbf
__________ TestProfilerAgent.test_build_family_tree_multi_generation __________

self = <test_profiler_agent.TestProfilerAgent object at 0x0000019FC93631D0>
profiler = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA0F8640>
db_session = <sqlmodel.orm.session.Session object at 0x0000019FCA069FD0>
sample_vault_id = UUID('58cbe849-069c-451a-9ad5-e76c948b88e3')

    @pytest.mark.asyncio
    async def test_build_family_tree_multi_generation(self, profiler, db_session, sample_vault_id):
        """Test family tree with multiple generations (grandparent \u2192 parent \u2192 child)."""
        # Create multi-generation family
        grandpa = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Grandpa Stark",
            type=EntityType.CHARACTER,
            properties={"role": "elder"},
            embedding=[0.1] * 1536
        )
        father = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Ned Stark",
            type=EntityType.CHARACTER,
            properties={"role": "father"},
            embedding=[0.2] * 1536
        )
        robb = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Robb Stark",
            type=EntityType.CHARACTER,
            properties={"role": "protagonist"},
            embedding=[0.3] * 1536
        )
    
        db_session.add_all([grandpa, father, robb])
    
        # Create relationships
        rel1 = Relationship(
            id=uuid4(),
            vault_id=sample_vault_id,
            from_entity_id=grandpa.id,
            to_entity_id=father.id,
            rel_type=RelationType.PARENT
        )
        rel2 = Relationship(
            id=uuid4(),
            vault_id=sample_vault_id,
            from_entity_id=father.id,
            to_entity_id=robb.id,
            rel_type=RelationType.PARENT
        )
        db_session.add_all([rel1, rel2])
        db_session.commit()
    
        # Test from Robb's perspective (middle of tree)
>       tree = await profiler.build_family_tree(robb.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\agents\test_profiler_agent.py:203: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA0F8640>
character_id = UUID('4b8bf160-be67-49ba-8c48-0d16278499ff')

    async def build_family_tree(self, character_id: UUID) -> Dict[str, Any]:
        """
        Builds a family tree visualization using NetworkX graph traversal.
        Traverses family relationships to find all family members and their generation levels.
    
        Uses NetworkX for graph analysis, enabling future features like:
        - Political influence pathfinding
        - Alliance mapping
        - Chemistry/relationship strength calculation
    
        Returns a hierarchical structure with:
        - All family members with their properties
        - Generation levels (negative = ancestors, positive = descendants, 0 = same generation)
        - Total member count and generation range
    
        Args:
            character_id: UUID of the character to build the tree from
    
        Returns:
            Dict containing:
                - total_members: int
                - generation_range: {"min": int, "max": int}
                - generations: {generation_level: [{"id": str, "name": str, "type": str, "properties": dict}]}
        """
        import networkx as nx
        from collections import deque
    
        self.log.info("building_family_tree", character_id=str(character_id))
    
        # Step 1: Fetch the root entity to get vault_id
>       with Session(db_utils.engine) as session:
                     ^^^^^^^^
E       NameError: name 'db_utils' is not defined

src\writeros\agents\profiler.py:112: NameError
---------------------------- Captured stdout setup ----------------------------
2025-11-25 16:31:05 [info     ] agent_initialized              agent=ProfilerAgent model=gpt-4
---------------------------- Captured stdout call -----------------------------
2025-11-25 16:31:05 [info     ] building_family_tree           agent=ProfilerAgent character_id=4b8bf160-be67-49ba-8c48-0d16278499ff
___________ TestProfilerAgent.test_build_family_tree_with_siblings ____________

self = <test_profiler_agent.TestProfilerAgent object at 0x0000019FC944F460>
profiler = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA06A330>
db_session = <sqlmodel.orm.session.Session object at 0x0000019FCA101D00>
sample_vault_id = UUID('03b3120b-d3f0-443b-8075-a441ee2df870')

    @pytest.mark.asyncio
    async def test_build_family_tree_with_siblings(self, profiler, db_session, sample_vault_id):
        """Test family tree with sibling relationships."""
        # Create siblings
        robb = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Robb Stark",
            type=EntityType.CHARACTER,
            properties={"role": "protagonist"},
            embedding=[0.1] * 1536
        )
        sansa = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Sansa Stark",
            type=EntityType.CHARACTER,
            properties={"role": "sibling"},
            embedding=[0.2] * 1536
        )
        arya = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Arya Stark",
            type=EntityType.CHARACTER,
            properties={"role": "sibling"},
            embedding=[0.3] * 1536
        )
    
        db_session.add_all([robb, sansa, arya])
    
        # Create sibling relationships
        rel1 = Relationship(
            id=uuid4(),
            vault_id=sample_vault_id,
            from_entity_id=robb.id,
            to_entity_id=sansa.id,
            rel_type=RelationType.SIBLING
        )
        rel2 = Relationship(
            id=uuid4(),
            vault_id=sample_vault_id,
            from_entity_id=sansa.id,
            to_entity_id=arya.id,
            rel_type=RelationType.SIBLING
        )
        db_session.add_all([rel1, rel2])
        db_session.commit()
    
        # Test from Robb's perspective
>       tree = await profiler.build_family_tree(robb.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\agents\test_profiler_agent.py:268: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA06A330>
character_id = UUID('7bc88442-fb22-401c-ac1d-66922f057d4f')

    async def build_family_tree(self, character_id: UUID) -> Dict[str, Any]:
        """
        Builds a family tree visualization using NetworkX graph traversal.
        Traverses family relationships to find all family members and their generation levels.
    
        Uses NetworkX for graph analysis, enabling future features like:
        - Political influence pathfinding
        - Alliance mapping
        - Chemistry/relationship strength calculation
    
        Returns a hierarchical structure with:
        - All family members with their properties
        - Generation levels (negative = ancestors, positive = descendants, 0 = same generation)
        - Total member count and generation range
    
        Args:
            character_id: UUID of the character to build the tree from
    
        Returns:
            Dict containing:
                - total_members: int
                - generation_range: {"min": int, "max": int}
                - generations: {generation_level: [{"id": str, "name": str, "type": str, "properties": dict}]}
        """
        import networkx as nx
        from collections import deque
    
        self.log.info("building_family_tree", character_id=str(character_id))
    
        # Step 1: Fetch the root entity to get vault_id
>       with Session(db_utils.engine) as session:
                     ^^^^^^^^
E       NameError: name 'db_utils' is not defined

src\writeros\agents\profiler.py:112: NameError
---------------------------- Captured stdout setup ----------------------------
2025-11-25 16:31:05 [info     ] agent_initialized              agent=ProfilerAgent model=gpt-4
---------------------------- Captured stdout call -----------------------------
2025-11-25 16:31:05 [info     ] building_family_tree           agent=ProfilerAgent character_id=7bc88442-fb22-401c-ac1d-66922f057d4f
______ TestProfilerAgent.test_build_family_tree_with_child_relationship _______

self = <test_profiler_agent.TestProfilerAgent object at 0x0000019FC944F680>
profiler = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA102F10>
db_session = <sqlmodel.orm.session.Session object at 0x0000019FCA103020>
sample_vault_id = UUID('6ce33180-3cba-4644-9252-041ce21bd00a')

    @pytest.mark.asyncio
    async def test_build_family_tree_with_child_relationship(self, profiler, db_session, sample_vault_id):
        """Test CHILD relationship (inverse of PARENT)."""
        # Create parent and child
        child = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Jon Snow",
            type=EntityType.CHARACTER,
            properties={"role": "child"},
            embedding=[0.1] * 1536
        )
        parent = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Ned Stark",
            type=EntityType.CHARACTER,
            properties={"role": "parent"},
            embedding=[0.2] * 1536
        )
    
        db_session.add_all([child, parent])
    
        # CHILD relationship: from_entity (child) \u2192 to_entity (parent)
        rel = Relationship(
            id=uuid4(),
            vault_id=sample_vault_id,
            from_entity_id=child.id,
            to_entity_id=parent.id,
            rel_type=RelationType.CHILD
        )
        db_session.add(rel)
        db_session.commit()
    
        # Test from child's perspective
>       tree = await profiler.build_family_tree(child.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\agents\test_profiler_agent.py:315: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA102F10>
character_id = UUID('2787f9f1-3df2-4667-9d04-d227e41943ae')

    async def build_family_tree(self, character_id: UUID) -> Dict[str, Any]:
        """
        Builds a family tree visualization using NetworkX graph traversal.
        Traverses family relationships to find all family members and their generation levels.
    
        Uses NetworkX for graph analysis, enabling future features like:
        - Political influence pathfinding
        - Alliance mapping
        - Chemistry/relationship strength calculation
    
        Returns a hierarchical structure with:
        - All family members with their properties
        - Generation levels (negative = ancestors, positive = descendants, 0 = same generation)
        - Total member count and generation range
    
        Args:
            character_id: UUID of the character to build the tree from
    
        Returns:
            Dict containing:
                - total_members: int
                - generation_range: {"min": int, "max": int}
                - generations: {generation_level: [{"id": str, "name": str, "type": str, "properties": dict}]}
        """
        import networkx as nx
        from collections import deque
    
        self.log.info("building_family_tree", character_id=str(character_id))
    
        # Step 1: Fetch the root entity to get vault_id
>       with Session(db_utils.engine) as session:
                     ^^^^^^^^
E       NameError: name 'db_utils' is not defined

src\writeros\agents\profiler.py:112: NameError
---------------------------- Captured stdout setup ----------------------------
2025-11-25 16:31:05 [info     ] agent_initialized              agent=ProfilerAgent model=gpt-4
---------------------------- Captured stdout call -----------------------------
2025-11-25 16:31:05 [info     ] building_family_tree           agent=ProfilerAgent character_id=2787f9f1-3df2-4667-9d04-d227e41943ae
_______________ TestProfilerAgent.test_build_family_tree_empty ________________

self = <test_profiler_agent.TestProfilerAgent object at 0x0000019FC93EA950>
profiler = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA33C5A0>
db_session = <sqlmodel.orm.session.Session object at 0x0000019FCA0D3550>
sample_vault_id = UUID('118cdeb9-895e-4157-a95b-66956b97bf1e')

    @pytest.mark.asyncio
    async def test_build_family_tree_empty(self, profiler, db_session, sample_vault_id):
        """Test family tree for entity with no relationships."""
        # Create isolated entity
        lonely = Entity(
            id=uuid4(),
            vault_id=sample_vault_id,
            name="Lonely Character",
            type=EntityType.CHARACTER,
            properties={},
            embedding=[0.1] * 1536
        )
        db_session.add(lonely)
        db_session.commit()
    
>       tree = await profiler.build_family_tree(lonely.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\agents\test_profiler_agent.py:339: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA33C5A0>
character_id = UUID('60f147c2-dcbb-41b8-b7f1-532a0e464b32')

    async def build_family_tree(self, character_id: UUID) -> Dict[str, Any]:
        """
        Builds a family tree visualization using NetworkX graph traversal.
        Traverses family relationships to find all family members and their generation levels.
    
        Uses NetworkX for graph analysis, enabling future features like:
        - Political influence pathfinding
        - Alliance mapping
        - Chemistry/relationship strength calculation
    
        Returns a hierarchical structure with:
        - All family members with their properties
        - Generation levels (negative = ancestors, positive = descendants, 0 = same generation)
        - Total member count and generation range
    
        Args:
            character_id: UUID of the character to build the tree from
    
        Returns:
            Dict containing:
                - total_members: int
                - generation_range: {"min": int, "max": int}
                - generations: {generation_level: [{"id": str, "name": str, "type": str, "properties": dict}]}
        """
        import networkx as nx
        from collections import deque
    
        self.log.info("building_family_tree", character_id=str(character_id))
    
        # Step 1: Fetch the root entity to get vault_id
>       with Session(db_utils.engine) as session:
                     ^^^^^^^^
E       NameError: name 'db_utils' is not defined

src\writeros\agents\profiler.py:112: NameError
---------------------------- Captured stdout setup ----------------------------
2025-11-25 16:31:05 [info     ] agent_initialized              agent=ProfilerAgent model=gpt-4
---------------------------- Captured stdout call -----------------------------
2025-11-25 16:31:05 [info     ] building_family_tree           agent=ProfilerAgent character_id=60f147c2-dcbb-41b8-b7f1-532a0e464b32
_________ TestProfilerAgent.test_build_family_tree_nonexistent_entity _________

self = <test_profiler_agent.TestProfilerAgent object at 0x0000019FC93EAB50>
profiler = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA31C450>
db_session = <sqlmodel.orm.session.Session object at 0x0000019FCA31C650>

    @pytest.mark.asyncio
    async def test_build_family_tree_nonexistent_entity(self, profiler, db_session):
        """Test family tree for nonexistent entity."""
        fake_id = uuid4()
    
>       tree = await profiler.build_family_tree(fake_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\agents\test_profiler_agent.py:352: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <writeros.agents.profiler.ProfilerAgent object at 0x0000019FCA31C450>
character_id = UUID('d37fb6b1-d576-4713-9609-aa67bc52c8dc')

    async def build_family_tree(self, character_id: UUID) -> Dict[str, Any]:
        """
        Builds a family tree visualization using NetworkX graph traversal.
        Traverses family relationships to find all family members and their generation levels.
    
        Uses NetworkX for graph analysis, enabling future features like:
        - Political influence pathfinding
        - Alliance mapping
        - Chemistry/relationship strength calculation
    
        Returns a hierarchical structure with:
        - All family members with their properties
        - Generation levels (negative = ancestors, positive = descendants, 0 = same generation)
        - Total member count and generation range
    
        Args:
            character_id: UUID of the character to build the tree from
    
        Returns:
            Dict containing:
                - total_members: int
                - generation_range: {"min": int, "max": int}
                - generations: {generation_level: [{"id": str, "name": str, "type": str, "properties": dict}]}
        """
        import networkx as nx
        from collections import deque
    
        self.log.info("building_family_tree", character_id=str(character_id))
    
        # Step 1: Fetch the root entity to get vault_id
>       with Session(db_utils.engine) as session:
                     ^^^^^^^^
E       NameError: name 'db_utils' is not defined

src\writeros\agents\profiler.py:112: NameError
---------------------------- Captured stdout setup ----------------------------
2025-11-25 16:31:05 [info     ] agent_initialized              agent=ProfilerAgent model=gpt-4
---------------------------- Captured stdout call -----------------------------
2025-11-25 16:31:05 [info     ] building_family_tree           agent=ProfilerAgent character_id=d37fb6b1-d576-4713-9609-aa67bc52c8dc
============================== warnings summary ===============================
src\writeros\config.py:4
  C:\Users\rahme\IdeaProjects\YouTube Transcript Agent\src\writeros\config.py:4: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Settings(BaseSettings):

tests/agents/test_profiler_agent.py: 66 warnings
  C:\Users\rahme\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\fields.py:747: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return fac()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.7-final-0 _______________

Name                                                     Stmts   Miss  Cover   Missing
--------------------------------------------------------------------------------------
src\writeros\__init__.py                                     1      0   100%
src\writeros\agents\__init__.py                             22     10    55%   14-23
src\writeros\agents\architect.py                           136    116    15%   15-16, 22-27, 36-158, 173-210, 220-251, 261-281, 287-305, 311-327
src\writeros\agents\base.py                                 19      2    89%   28-29
src\writeros\agents\chronologist.py                         22      6    73%   25-26, 30-57
src\writeros\agents\dramatist.py                           150    128    15%   22-27, 38-53, 64-87, 91-114, 118-141, 154-191, 204-248, 252-268, 272-289, 300-317
src\writeros\agents\mechanic.py                             31      6    81%   39-40, 43-68
src\writeros\agents\navigator.py                            26      6    77%   34-35, 38-59
src\writeros\agents\orchestrator.py                        118    118     0%   6-300
src\writeros\agents\producer.py                            203    170    16%   19-27, 30-32, 36-45, 53-63, 67-85, 89-97, 101-110, 114-121, 129-159, 163-199, 207-219, 223-243, 247-264, 272-279, 283-291, 295-305, 313-331, 339-382
src\writeros\agents\profiler.py                            201    127    37%   113-274, 299-303, 374-461, 490-529
src\writeros\agents\psychologist.py                         40     16    60%   38-39, 42-66, 73-92
src\writeros\agents\stylist.py                              14      7    50%   8, 12-13, 16-49
src\writeros\agents\theorist.py                             34      6    82%   37-39, 42-65
src\writeros\agents\tools.py                                31     31     0%   5-76
src\writeros\agents\tools_registry.py                      129    129     0%   7-660
src\writeros\api\__init__.py                                 0      0   100%
src\writeros\api\app.py                                    228    228     0%   13-616
src\writeros\cli\__init__.py                                 0      0   100%
src\writeros\cli\main.py                                    41     41     0%   1-83
src\writeros\config.py                                      16      2    88%   26, 33
src\writeros\core\__init__.py                                0      0   100%
src\writeros\core\logging.py                                13      6    54%   14-42
src\writeros\graphs\__init__.py                              0      0   100%
src\writeros\preprocessing\__init__.py                       4      4     0%   7-23
src\writeros\preprocessing\chunker.py                       78     78     0%   5-143
src\writeros\preprocessing\cluster_semantic_chunker.py     155    155     0%   10-406
src\writeros\preprocessing\unified_chunker.py              160    160     0%   14-405
src\writeros\rag\__init__.py                                 2      2     0%   1-3
src\writeros\rag\retriever.py                              124    124     0%   6-298
src\writeros\schema\__init__.py                             18      0   100%
src\writeros\schema\api.py                                  22      0   100%
src\writeros\schema\base.py                                 12      0   100%
src\writeros\schema\enums.py                               132      0   100%
src\writeros\schema\extended_universe.py                    90      0   100%
src\writeros\schema\graph.py                                16      0   100%
src\writeros\schema\identity.py                             41      0   100%
src\writeros\schema\library.py                              74      9    88%   51-61, 127
src\writeros\schema\logistics.py                            17      0   100%
src\writeros\schema\mechanics.py                            20      0   100%
src\writeros\schema\narrative.py                            19      0   100%
src\writeros\schema\project.py                              13      0   100%
src\writeros\schema\prose.py                                14      0   100%
src\writeros\schema\psychology.py                           37      0   100%
src\writeros\schema\session.py                              27      0   100%
src\writeros\schema\temporal_anchoring.py                   54      0   100%
src\writeros\schema\theme.py                                16      0   100%
src\writeros\schema\world.py                                80      0   100%
src\writeros\services\__init__.py                            0      0   100%
src\writeros\services\conflict_engine.py                    31     21    32%   11-16, 20-44, 48-64
src\writeros\tasks\__init__.py                               0      0   100%
src\writeros\utils\db.py                                   143    121    15%   17-23, 70-148, 162-241, 251-252, 262-284, 291-302, 310-325, 336-346
src\writeros\utils\embeddings.py                            41     18    56%   22-29, 32-42, 46, 50, 54, 65, 75
src\writeros\utils\llm_client.py                            54     38    30%   56-99, 122-135, 152-156
--------------------------------------------------------------------------------------
TOTAL                                                     2969   1885    37%
Coverage HTML written to dir htmlcov
=========================== short test summary info ===========================
FAILED tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_simple
FAILED tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_multi_generation
FAILED tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_with_siblings
FAILED tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_with_child_relationship
FAILED tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_empty
FAILED tests/agents/test_profiler_agent.py::TestProfilerAgent::test_build_family_tree_nonexistent_entity
================== 6 failed, 5 passed, 67 warnings in 4.81s ===================
