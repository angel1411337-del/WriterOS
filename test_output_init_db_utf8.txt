============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\rahme\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\rahme\IdeaProjects\YouTube Transcript Agent
configfile: pyproject.toml
plugins: anyio-4.11.0, Faker-38.2.0, langsmith-0.4.45, asyncio-1.3.0, cov-7.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 23 items

tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_creates_tables PASSED [  4%]
tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_enables_pgvector PASSED [  8%]
tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_creates_vector_indexes FAILED [ 13%]
tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_respects_mode_setting PASSED [ 17%]
tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_creates_admin_user_in_local_mode FAILED [ 21%]
tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_creates_default_vault_in_local_mode FAILED [ 26%]
tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_does_not_duplicate_admin_user FAILED [ 30%]
tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_vault_has_owner_link FAILED [ 34%]
tests/utils/test_init_db.py::TestUUIDPreservation::test_read_uuid_from_filesystem_when_exists PASSED [ 39%]
tests/utils/test_init_db.py::TestUUIDPreservation::test_read_uuid_from_filesystem_when_missing PASSED [ 43%]
tests/utils/test_init_db.py::TestUUIDPreservation::test_read_uuid_from_filesystem_with_invalid_format PASSED [ 47%]
tests/utils/test_init_db.py::TestUUIDPreservation::test_write_uuid_to_filesystem PASSED [ 52%]
tests/utils/test_init_db.py::TestUUIDPreservation::test_write_uuid_creates_directory PASSED [ 56%]
tests/utils/test_init_db.py::TestUUIDPreservation::test_ensure_default_vault_preserves_existing_uuid FAILED [ 60%]
tests/utils/test_init_db.py::TestGetDirectoryName::test_get_directory_name_from_path PASSED [ 65%]
tests/utils/test_init_db.py::TestGetDirectoryName::test_get_directory_name_handles_special_chars PASSED [ 69%]
tests/utils/test_init_db.py::TestGetDirectoryName::test_get_directory_name_fallback PASSED [ 73%]
tests/utils/test_init_db.py::TestGetOrCreateVaultId::test_get_or_create_vault_id_creates_new PASSED [ 78%]
tests/utils/test_init_db.py::TestGetOrCreateVaultId::test_get_or_create_vault_id_returns_existing PASSED [ 82%]
tests/utils/test_init_db.py::TestInitDbErrorHandling::test_init_db_retries_on_connection_failure PASSED [ 86%]
tests/utils/test_init_db.py::TestInitDbErrorHandling::test_init_db_logs_errors PASSED [ 91%]
tests/utils/test_init_db.py::TestInitDbIntegration::test_init_db_full_flow FAILED [ 95%]
tests/utils/test_init_db.py::TestInitDbIntegration::test_init_db_is_idempotent PASSED [100%]

================================== FAILURES ===================================
____________ TestInitDbBasics.test_init_db_creates_vector_indexes _____________

self = <test_init_db.TestInitDbBasics object at 0x000002A459650770>
test_engine = Engine(postgresql://writer:***@127.0.0.1:5433/writeros_test)

    @pytest.mark.slow
    def test_init_db_creates_vector_indexes(self, test_engine):
        """Test that init_db creates HNSW indexes for vector columns."""
        with Session(test_engine) as session:
            # Check for HNSW indexes on key tables
            index_check_query = text("""
                SELECT indexname FROM pg_indexes
                WHERE indexname LIKE '%embedding%'
                AND indexname LIKE '%hnsw%'
            """)
    
            indexes = session.exec(index_check_query).all()
            index_names = [idx[0] for idx in indexes]
    
            # Should have indexes for at least entities and documents
            has_entity_index = any('entities' in name for name in index_names)
            has_document_index = any('documents' in name for name in index_names)
    
>           assert has_entity_index or has_document_index, \
                "Should create HNSW indexes for vector columns"
E           AssertionError: Should create HNSW indexes for vector columns
E           assert (False or False)

tests\utils\test_init_db.py:73: AssertionError
_____ TestEnsureDefaultUserAndVault.test_creates_admin_user_in_local_mode _____

self = <test_init_db.TestEnsureDefaultUserAndVault object at 0x000002A45949B110>
db_session = <sqlmodel.orm.session.Session object at 0x000002A459E93100>

    @patch.dict(os.environ, {"WRITEROS_MODE": "local", "VAULT_PATH": "/test/vault"})
    def test_creates_admin_user_in_local_mode(self, db_session):
        """Test that admin user is created in LOCAL mode."""
        # Clear any existing users
>       db_session.exec(text("DELETE FROM users")).all()

tests\utils\test_init_db.py:91: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:1384: in all
    return self._allrows()
           ^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:546: in _allrows
    make_row = self._row_getter
               ^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:471: in _row_getter
    key_to_index = metadata._key_to_index
                   ^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1366: in _key_to_index
    self._we_dont_return_rows()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.engine.cursor._NoResultMetaData object at 0x000002A43DDB70C0>
err = None

    def _we_dont_return_rows(self, err=None):
>       raise exc.ResourceClosedError(
            "This result object does not return rows. "
            "It has been closed automatically."
        ) from err
E       sqlalchemy.exc.ResourceClosedError: This result object does not return rows. It has been closed automatically.

..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1346: ResourceClosedError
___ TestEnsureDefaultUserAndVault.test_creates_default_vault_in_local_mode ____

self = <test_init_db.TestEnsureDefaultUserAndVault object at 0x000002A45949B390>
db_session = <sqlmodel.orm.session.Session object at 0x000002A45A134FC0>

    @patch.dict(os.environ, {"WRITEROS_MODE": "local", "VAULT_PATH": "/test/vault"})
    def test_creates_default_vault_in_local_mode(self, db_session):
        """Test that default vault is created in LOCAL mode."""
        # Clear existing vaults
>       db_session.exec(text("DELETE FROM vaults")).all()

tests\utils\test_init_db.py:110: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:1384: in all
    return self._allrows()
           ^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:546: in _allrows
    make_row = self._row_getter
               ^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:471: in _row_getter
    key_to_index = metadata._key_to_index
                   ^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1366: in _key_to_index
    self._we_dont_return_rows()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.engine.cursor._NoResultMetaData object at 0x000002A43DDB70C0>
err = None

    def _we_dont_return_rows(self, err=None):
>       raise exc.ResourceClosedError(
            "This result object does not return rows. "
            "It has been closed automatically."
        ) from err
E       sqlalchemy.exc.ResourceClosedError: This result object does not return rows. It has been closed automatically.

..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1346: ResourceClosedError
______ TestEnsureDefaultUserAndVault.test_does_not_duplicate_admin_user _______

self = <test_init_db.TestEnsureDefaultUserAndVault object at 0x000002A4596508A0>
db_session = <sqlmodel.orm.session.Session object at 0x000002A459F83E30>

    @patch.dict(os.environ, {"WRITEROS_MODE": "local", "VAULT_PATH": "/test/vault"})
    def test_does_not_duplicate_admin_user(self, db_session):
        """Test that running twice doesn't create duplicate admin users."""
        # Clear existing
>       db_session.exec(text("DELETE FROM vaults")).all()

tests\utils\test_init_db.py:130: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:1384: in all
    return self._allrows()
           ^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:546: in _allrows
    make_row = self._row_getter
               ^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:471: in _row_getter
    key_to_index = metadata._key_to_index
                   ^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1366: in _key_to_index
    self._we_dont_return_rows()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.engine.cursor._NoResultMetaData object at 0x000002A43DDB70C0>
err = None

    def _we_dont_return_rows(self, err=None):
>       raise exc.ResourceClosedError(
            "This result object does not return rows. "
            "It has been closed automatically."
        ) from err
E       sqlalchemy.exc.ResourceClosedError: This result object does not return rows. It has been closed automatically.

..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1346: ResourceClosedError
___________ TestEnsureDefaultUserAndVault.test_vault_has_owner_link ___________

self = <test_init_db.TestEnsureDefaultUserAndVault object at 0x000002A459650B00>
db_session = <sqlmodel.orm.session.Session object at 0x000002A45A038C00>

    @patch.dict(os.environ, {"WRITEROS_MODE": "local", "VAULT_PATH": "/test/vault"})
    def test_vault_has_owner_link(self, db_session):
        """Test that created vault is linked to admin user."""
        # Clear existing
>       db_session.exec(text("DELETE FROM vaults")).all()

tests\utils\test_init_db.py:149: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:1384: in all
    return self._allrows()
           ^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:546: in _allrows
    make_row = self._row_getter
               ^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:471: in _row_getter
    key_to_index = metadata._key_to_index
                   ^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1366: in _key_to_index
    self._we_dont_return_rows()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.engine.cursor._NoResultMetaData object at 0x000002A43DDB70C0>
err = None

    def _we_dont_return_rows(self, err=None):
>       raise exc.ResourceClosedError(
            "This result object does not return rows. "
            "It has been closed automatically."
        ) from err
E       sqlalchemy.exc.ResourceClosedError: This result object does not return rows. It has been closed automatically.

..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1346: ResourceClosedError
___ TestUUIDPreservation.test_ensure_default_vault_preserves_existing_uuid ____

self = <test_init_db.TestUUIDPreservation object at 0x000002A4595C5260>
db_session = <sqlmodel.orm.session.Session object at 0x000002A45A03AE00>
tmp_path = WindowsPath('C:/Users/rahme/AppData/Local/Temp/pytest-of-rahme/pytest-41/test_ensure_default_vault_pres0')

    @patch.dict(os.environ, {"WRITEROS_MODE": "local"})
    def test_ensure_default_vault_preserves_existing_uuid(self, db_session, tmp_path):
        """Test that existing filesystem UUID is preserved in database."""
        # Create existing UUID on filesystem
        existing_uuid = uuid4()
        writeros_dir = tmp_path / ".writeros"
        writeros_dir.mkdir()
        (writeros_dir / "vault_id").write_text(str(existing_uuid))
    
        # Clear database
>       db_session.exec(text("DELETE FROM vaults")).all()

tests\utils\test_init_db.py:239: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:1384: in all
    return self._allrows()
           ^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:546: in _allrows
    make_row = self._row_getter
               ^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\result.py:471: in _row_getter
    key_to_index = metadata._key_to_index
                   ^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1366: in _key_to_index
    self._we_dont_return_rows()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.engine.cursor._NoResultMetaData object at 0x000002A43DDB70C0>
err = None

    def _we_dont_return_rows(self, err=None):
>       raise exc.ResourceClosedError(
            "This result object does not return rows. "
            "It has been closed automatically."
        ) from err
E       sqlalchemy.exc.ResourceClosedError: This result object does not return rows. It has been closed automatically.

..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\cursor.py:1346: ResourceClosedError
________________ TestInitDbIntegration.test_init_db_full_flow _________________

self = <test_init_db.TestInitDbIntegration object at 0x000002A45949BD90>
test_engine = Engine(postgresql://writer:***@127.0.0.1:5433/writeros_test)

    @pytest.mark.integration
    @patch.dict(os.environ, {"WRITEROS_MODE": "local", "VAULT_PATH": "/test/vault"})
    def test_init_db_full_flow(self, test_engine):
        """Test complete init_db flow creates usable database."""
        # Run init_db
>       init_db()

tests\utils\test_init_db.py:342: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\writeros\utils\db.py:135: in init_db
    ensure_default_user_and_vault()
src\writeros\utils\db.py:232: in ensure_default_user_and_vault
    write_uuid_to_filesystem(vault.id, vault_path)
src\writeros\utils\db.py:298: in write_uuid_to_filesystem
    config_dir.mkdir(exist_ok=True)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WindowsPath('/test/vault/.writeros'), mode = 511, parents = False
exist_ok = True

    def mkdir(self, mode=0o777, parents=False, exist_ok=False):
        """
        Create a new directory at this given path.
        """
        try:
>           os.mkdir(self, mode)
E           FileNotFoundError: [WinError 3] The system cannot find the path specified: '\\test\\vault\\.writeros'

..\..\AppData\Local\Programs\Python\Python313\Lib\pathlib\_local.py:722: FileNotFoundError
------------------------------ Captured log call ------------------------------
ERROR    writeros.utils.db:db.py:142 [2m2025-11-25T21:10:02.990207Z[0m [[31m[1merror    [0m] [1mdatabase_connection_failed    [0m [36mattempt[0m=[35m1[0m [36merror[0m=[35m"[WinError 3] The system cannot find the path specified: '\\\\test\\\\vault\\\\.writeros'"[0m
ERROR    writeros.utils.db:db.py:142 [2m2025-11-25T21:10:05.120450Z[0m [[31m[1merror    [0m] [1mdatabase_connection_failed    [0m [36mattempt[0m=[35m2[0m [36merror[0m=[35m"[WinError 3] The system cannot find the path specified: '\\\\test\\\\vault\\\\.writeros'"[0m
ERROR    writeros.utils.db:db.py:142 [2m2025-11-25T21:10:07.218942Z[0m [[31m[1merror    [0m] [1mdatabase_connection_failed    [0m [36mattempt[0m=[35m3[0m [36merror[0m=[35m"[WinError 3] The system cannot find the path specified: '\\\\test\\\\vault\\\\.writeros'"[0m
ERROR    writeros.utils.db:db.py:142 [2m2025-11-25T21:10:09.312735Z[0m [[31m[1merror    [0m] [1mdatabase_connection_failed    [0m [36mattempt[0m=[35m4[0m [36merror[0m=[35m"[WinError 3] The system cannot find the path specified: '\\\\test\\\\vault\\\\.writeros'"[0m
ERROR    writeros.utils.db:db.py:142 [2m2025-11-25T21:10:11.402422Z[0m [[31m[1merror    [0m] [1mdatabase_connection_failed    [0m [36mattempt[0m=[35m5[0m [36merror[0m=[35m"[WinError 3] The system cannot find the path specified: '\\\\test\\\\vault\\\\.writeros'"[0m
CRITICAL writeros.utils.db:db.py:147 [2m2025-11-25T21:10:11.402707Z[0m [[31m[1mcritical [0m] [1minitialization_failed         [0m
============================== warnings summary ===============================
src\writeros\config.py:4
  C:\Users\rahme\IdeaProjects\YouTube Transcript Agent\src\writeros\config.py:4: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Settings(BaseSettings):

tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_creates_tables
  C:\Users\rahme\IdeaProjects\YouTube Transcript Agent\src\writeros\api\app.py:113: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_creates_tables
tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_creates_tables
  C:\Users\rahme\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py:4575: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_creates_tables
  C:\Users\rahme\IdeaProjects\YouTube Transcript Agent\src\writeros\api\app.py:128: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

tests/utils/test_init_db.py: 14 warnings
  C:\Users\rahme\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\fields.py:747: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return fac()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.7-final-0 _______________

Name                                                     Stmts   Miss  Cover   Missing
--------------------------------------------------------------------------------------
src\writeros\__init__.py                                     1      0   100%
src\writeros\agents\__init__.py                             22     10    55%   14-23
src\writeros\agents\architect.py                           136    116    15%   15-16, 22-27, 36-158, 173-210, 220-251, 261-281, 287-305, 311-327
src\writeros\agents\base.py                                 19      9    53%   21-39
src\writeros\agents\chronologist.py                         22      6    73%   25-26, 30-57
src\writeros\agents\dramatist.py                           150    128    15%   22-27, 38-53, 64-87, 91-114, 118-141, 154-191, 204-248, 252-268, 272-289, 300-317
src\writeros\agents\mechanic.py                             31      6    81%   39-40, 43-68
src\writeros\agents\navigator.py                            26      6    77%   34-35, 38-59
src\writeros\agents\orchestrator.py                        107     83    22%   24-38, 51-106, 118-124, 127-136, 142-157, 163-172, 175-212, 215, 230-257
src\writeros\agents\producer.py                            203    170    16%   19-27, 30-32, 36-45, 53-63, 67-85, 89-97, 101-110, 114-121, 129-159, 163-199, 207-219, 223-243, 247-264, 272-279, 283-291, 295-305, 313-331, 339-382
src\writeros\agents\profiler.py                            201    154    23%   54-55, 58-80, 106-274, 285-303, 330-461, 475, 478, 490-529
src\writeros\agents\psychologist.py                         40     16    60%   38-39, 42-66, 73-92
src\writeros\agents\stylist.py                              14      7    50%   8, 12-13, 16-49
src\writeros\agents\theorist.py                             34      6    82%   37-39, 42-65
src\writeros\agents\tools.py                                31     31     0%   5-76
src\writeros\agents\tools_registry.py                      129    110    15%   35-39, 56, 276-304, 323-378, 392-437, 451-496, 508-549, 562-577, 589-620, 631-660
src\writeros\api\__init__.py                                 0      0   100%
src\writeros\api\app.py                                    228    146    36%   54-55, 60-66, 116-125, 131, 141, 178-222, 236-284, 309-356, 361-381, 417-470, 487-505, 528-587, 597-598, 616
src\writeros\cli\__init__.py                                 0      0   100%
src\writeros\cli\main.py                                    41     41     0%   1-83
src\writeros\config.py                                      16      2    88%   26, 33
src\writeros\core\__init__.py                                0      0   100%
src\writeros\core\logging.py                                13      1    92%   32
src\writeros\graphs\__init__.py                              0      0   100%
src\writeros\preprocessing\__init__.py                       4      0   100%
src\writeros\preprocessing\chunker.py                       78     61    22%   24-30, 34-39, 46-57, 70-72, 78-114, 117-143
src\writeros\preprocessing\cluster_semantic_chunker.py     155    134    14%   51-65, 82-130, 150-190, 194-197, 206-218, 233-268, 282-291, 313-362, 370-377, 385-406
src\writeros\preprocessing\unified_chunker.py              160    124    22%   40-41, 48-52, 56-66, 70-80, 84, 88-91, 101-104, 130-151, 175-224, 236-243, 247-261, 270-279, 290-329, 337-351, 358-368, 372-374, 404-405
src\writeros\rag\__init__.py                                 2      2     0%   1-3
src\writeros\rag\retriever.py                               74     74     0%   5-171
src\writeros\schema\__init__.py                             18      0   100%
src\writeros\schema\api.py                                  22      0   100%
src\writeros\schema\base.py                                 12      0   100%
src\writeros\schema\enums.py                               132      0   100%
src\writeros\schema\extended_universe.py                    90      0   100%
src\writeros\schema\graph.py                                16      0   100%
src\writeros\schema\identity.py                             41      0   100%
src\writeros\schema\library.py                              74      9    88%   51-61, 127
src\writeros\schema\logistics.py                            17      0   100%
src\writeros\schema\mechanics.py                            20      0   100%
src\writeros\schema\narrative.py                            19      0   100%
src\writeros\schema\project.py                              13      0   100%
src\writeros\schema\prose.py                                14      0   100%
src\writeros\schema\psychology.py                           37      0   100%
src\writeros\schema\session.py                              27      0   100%
src\writeros\schema\temporal_anchoring.py                   54      0   100%
src\writeros\schema\theme.py                                16      0   100%
src\writeros\schema\world.py                                80      0   100%
src\writeros\services\__init__.py                            0      0   100%
src\writeros\services\conflict_engine.py                    31     21    32%   11-16, 20-44, 48-64
src\writeros\tasks\__init__.py                               0      0   100%
src\writeros\utils\db.py                                   143     14    90%   17-23, 137, 236-239, 251-252, 267, 294, 313, 323
src\writeros\utils\embeddings.py                            41     18    56%   22-29, 32-42, 46, 50, 54, 65, 75
src\writeros\utils\indexer.py                               87     69    21%   34-49, 64-111, 119-197, 201-214, 223, 227-228
src\writeros\utils\llm_client.py                            54     42    22%   24-30, 56-99, 122-135, 152-156, 169
src\writeros\utils\writer.py                               178    154    13%   17-29, 32-44, 47-49, 52, 55, 58-62, 67-89, 93-130, 135-194, 197-235, 238-266, 269-274, 278-366
--------------------------------------------------------------------------------------
TOTAL                                                     3173   1770    44%
Coverage HTML written to dir htmlcov
=========================== short test summary info ===========================
FAILED tests/utils/test_init_db.py::TestInitDbBasics::test_init_db_creates_vector_indexes
FAILED tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_creates_admin_user_in_local_mode
FAILED tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_creates_default_vault_in_local_mode
FAILED tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_does_not_duplicate_admin_user
FAILED tests/utils/test_init_db.py::TestEnsureDefaultUserAndVault::test_vault_has_owner_link
FAILED tests/utils/test_init_db.py::TestUUIDPreservation::test_ensure_default_vault_preserves_existing_uuid
FAILED tests/utils/test_init_db.py::TestInitDbIntegration::test_init_db_full_flow
================= 7 failed, 16 passed, 19 warnings in 12.66s ==================
